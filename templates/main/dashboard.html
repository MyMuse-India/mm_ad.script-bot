{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">MyMuse Ad Script Generator</h5>
      </div>
      <div class="card-body">
        
        <!-- Step 1: Transcribe + Generate with Product Integration -->
        <div class="mb-4">
          <h6 class="text-primary">Step 1: Transcribe & Generate with Product Integration</h6>
          <form method="post" action="{{ url_for('transcribe_route') }}" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="mb-3">
              <label class="form-label">Select MyMuse Product:</label>
              <select class="form-select" name="product_name" required>
                <option value="">Choose a product...</option>
                <option value="dive+">Dive+</option>
                <option value="link+">Link+</option>
                <option value="beat">Beat</option>
                <option value="breeze">Breeze</option>
                <option value="groove+">Groove+</option>
                <option value="edge">Edge</option>
                <option value="pulse">Pulse</option>
                <option value="flick">Flick</option>
                <option value="oh! please gel">Oh! Please Gel</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Upload Media File:</label>
              <input class="form-control" type="file" name="media" accept="audio/*,video/*">
              <small class="text-muted">Supports: mp4, mov, webm, mp3, wav, m4a</small>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Or Media URL:</label>
              <input class="form-control" type="url" name="media_url" placeholder="https://...">
            </div>
            
            <div class="row mb-3">
              <div class="col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="instagram_mode" id="instagram_mode">
                  <label class="form-check-label" for="instagram_mode">Instagram Style</label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="pg13_mode" id="pg13_mode">
                  <label class="form-check-label" for="pg13_mode">PG-13 Mode</label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="genz_mode" id="genz_mode">
                  <label class="form-check-label" for="genz_mode">Gen-Z Tone</label>
                </div>
              </div>
            </div>
            
            <button type="submit" class="btn btn-primary w-100">üé¨ Transcribe & Generate Script</button>
          </form>
        </div>
        
        <hr>
        
        <!-- Step 2: Paste Transcript + Choose Product (No Auto-Detect) -->
        <div class="mb-4">
          <h6 class="text-success">Step 2: Paste Transcript + Choose Product</h6>
          <form method="post" action="{{ url_for('generate_route') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="mb-3">
              <label class="form-label">Select MyMuse Product:</label>
              <select class="form-select" name="product_name" required>
                <option value="">Choose a product...</option>
                <option value="dive+">Dive+</option>
                <option value="link+">Link+</option>
                <option value="beat">Beat</option>
                <option value="breeze">Breeze</option>
                <option value="groove+">Groove+</option>
                <option value="edge">Edge</option>
                <option value="pulse">Pulse</option>
                <option value="flick">Flick</option>
                <option value="oh! please gel">Oh! Please Gel</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Paste Your Transcript:</label>
              <textarea class="form-control" name="transcript_text" rows="4" placeholder="Paste your transcript here..." required></textarea>
            </div>
            
            <div class="row mb-3">
              <div class="col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="instagram_mode" id="instagram_mode2">
                  <label class="form-check-label" for="instagram_mode2">Instagram Style</label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="pg13_mode" id="pg13_mode2">
                  <label class="form-check-label" for="pg13_mode2">PG-13 Mode</label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="genz_mode" id="genz_mode2">
                  <label class="form-check-label" for="genz_mode2">Gen-Z Tone</label>
                </div>
              </div>
            </div>
            
            <button type="submit" class="btn btn-success w-100">‚ú® Generate with Selected Product</button>
          </form>
        </div>
        
        <hr>
        
        <!-- Step 3: Paste + Generate Variations (No Product) -->
        <div class="mb-4">
          <h6 class="text-warning">Step 3: Generate Variations (No Product Integration)</h6>
          <form method="post" action="{{ url_for('generate_variations_only') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="mb-3">
              <label class="form-label">Paste Your Script:</label>
              <textarea class="form-control" name="script_text" rows="4" placeholder="Paste your script here..." required></textarea>
            </div>
            
            <div class="row mb-3">
              <div class="col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="instagram_mode" id="instagram_mode3">
                  <label class="form-check-label" for="instagram_mode3">Instagram Style</label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="pg13_mode" id="pg13_mode3">
                  <label class="form-check-label" for="pg13_mode3">PG-13 Mode</label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="genz_mode" id="genz_mode3">
                  <label class="form-check-label" for="genz_mode3">Gen-Z Tone</label>
                </div>
              </div>
            </div>
            
            <button type="submit" class="btn btn-warning w-100">üîÑ Generate 10 Variations</button>
          </form>
        </div>
        
      </div>
    </div>
  </div>
  
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Generated Results</h5>
      </div>
      <div class="card-body">
        
        {% if transcript %}
        <div class="mb-3">
          <h6>Current Transcript</h6>
          <div class="bg-light p-3 rounded">
            <small class="text-muted">{{ transcript }}</small>
          </div>
        </div>
        {% endif %}
        
        {% if generated %}
        <div class="mb-3">
          <h6>Generated Script</h6>
          <div class="bg-light p-3 rounded">
            <p class="mb-0">{{ generated }}</p>
          </div>
          <button class="btn btn-sm btn-outline-primary mt-2" onclick="copyToClipboard('{{ generated }}')">Copy Script</button>
        </div>
        {% endif %}
        
        {% if variations %}
        <div class="mb-3">
          <h6>Variations ({{ variations|length }})</h6>
          {% for variation in variations %}
          <div class="border-start border-primary ps-3 mb-2">
            <p class="mb-1">{{ variation.text }}</p>
            {% if variation.evaluation %}
            <small class="text-muted">
              Score: {{ variation.evaluation.score }}/100 | 
              Pass: {{ "‚úÖ" if variation.evaluation.pass else "‚ùå" }}
            </small>
            {% endif %}
            <button class="btn btn-sm btn-outline-secondary" onclick="copyToClipboard('{{ variation.text }}')">Copy</button>
          </div>
          {% endfor %}
        </div>
        {% endif %}
        
        {% if not transcript and not generated and not variations %}
        <div class="text-center text-muted py-5">
          <h6>No results yet</h6>
          <p class="mb-0">Use one of the options on the left to generate your MyMuse ad scripts</p>
        </div>
        {% endif %}
        
      </div>
    </div>
  </div>
</div>

<script>
function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(function() {
    // Show a brief success message
    const btn = event.target;
    const originalText = btn.textContent;
    btn.textContent = 'Copied!';
    btn.classList.add('btn-success');
    setTimeout(() => {
      btn.textContent = originalText;
      btn.classList.remove('btn-success');
    }, 1000);
  });
}
</script>
{% endblock %}

